<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ChatBox</title>
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"></link>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
</head>
<body>
  <ul id="users"></ul>
  <form method="" action="">
    <input type="text" class="inputMessage">
    <button>Send</button>
  </form>
  
  <ul style="list-style-type:none;" id="messages"></ul>
  
<script>

$(function() {

  var userList    = $('#users');
  var messageList = $('#messages');
  
  var socket = io.connect();
  
  socket.on('connect', function(){
    console.log('hello');
    var username = prompt("Enter a username");
    socket.emit('join', username);
  }); 
  
  socket.on('text', function(msg) {
    var li = $('<li></li>');
    li.html(msg);
    messageList.append(li);

    // Ensure that autoscrolling is ocurring
    messageList.scrollTop(messageList[0].scrollHeight);
  });
  socket.on('user connected', addUsers);

  function addUsers(usernames) {
      for (var name in usernames){
          var li = $('<li></li>');
          li.addClass('user');
          li.html('<i class="icon-user"></i> '+ usernames[name]);
          userList.append(li);
      }
    }

  $('form').submit(function(event){
    
    msg = $('.inputMessage').val();
    socket.emit('text', msg);
    event.preventDefault();
    $('.inputMessage').val('');
  });
});

</script>
</body>

</html>